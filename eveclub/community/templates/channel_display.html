{% extends 'channel_base.html' %}

{% block title %}{{channel.name}}{% endblock %}

{% block more_content %}
<div id="topic_list">
<table width="100%">
<tr class="topic_list_header">
  <td width="6%">状态</td>
  <td>标题</td>
  <td width="14%">作者</td>
  <td width="14%">最后回复</td>
  <td width="7%">点击数</td>
  <td width="7%">回复数</td>
</tr>
{% for t in topics %}
<tr class="{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
  <td>{% if t.is_sticky %}置顶{% endif %}{% if t.is_essence %}<br />精华{t.essence_level}{% endif %}</td>
  <td class="topic_list_title"><a href="/topic/{{ t.id }}">{{ t.title }}</a><br /><span style="color: #777">{{ t.shortcontent | slice:":36"}}</span></td>
  <td><a href='/pilot/{{ t.create_author.id }}/'>{{ t.create_author }}</a><br />{{ t.create_time | date:"Y-m-d H:i"}}</td>
  <td><a href='/pilot/{{ t.update_author.id }}/'>{{ t.update_author }}</a><br />{{ t.update_time | date:"Y-m-d H:i"}}</td>
  <td>{{ t.clicks }}</td>
  <td>{{ t.replies }}</td>
</tr>
{% endfor %}

</table>
</div>

{% if user.is_authenticated %}
<div class="user_action">
  <p><a href="#" class="btn" onclick="$('#reply_form').show(); return false;">我要发帖</a></p>
</div>
<div id="reply_form" class="row">
  <div class="span8">
  <form action="/community/topic/new/" method="post">{% csrf_token %}
    <input type="hidden" name="channel_id" value="{{ channel.id }}" />
    <input type="hidden" name="topic_type" value="normal" />
    <p><label>标题：</label><input type="text" name="title" class="topic_title_input" /></p>
    <p><label>内容：</label><textarea id="editor" name="content" class="reply_textarea"></textarea></p>
    <p><input type="submit" value="发布" class="btn" /> <a href="#" class="btn" onclick="$('#reply_form').hide(); return false;">算了不说了</a></p>
  </form>
  </div>
  {% include 'editor.html' %}
</div>
{% endif %}
{% endblock %}